# -*- coding: utf-8 -*-
# -------------------------------------------------------------
# Two-probe Configuration
# -------------------------------------------------------------

# -------------------------------------------------------------
# Left Electrode
# -------------------------------------------------------------

# Set up lattice
vector_a = [10.0, 0.0, 0.0]*Angstrom
vector_b = [0.0, 27.0, 0.0]*Angstrom
vector_c = [0.0, 0.0, 7.38300513133]*Angstrom
left_electrode_lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
left_electrode_elements = [Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen]

# Define coordinates
left_electrode_coordinates = [[  4.975328278222,  14.147767530363,   0.664109092829],
                              [  4.975328278222,  15.237767452169,   0.664109092829],
                              [  4.975328278222,  18.079487452169,   0.664109092829],
                              [  4.975328278221,  19.500347452169,   0.664109092829],
                              [  4.975328278221,  15.948197452169,   1.89460994805 ],
                              [  4.975328278222,  17.369057452169,   1.89460994805 ],
                              [  4.975328278222,  20.210777452169,   1.89460994805 ],
                              [  4.975328278222,  21.300777373974,   1.89460994805 ],
                              [  4.975328278222,  14.147767530363,   3.125110803271],
                              [  4.975328278222,  15.237767452169,   3.125110803271],
                              [  4.975328278222,  18.079487452169,   3.125110803271],
                              [  4.975328278221,  19.500347452169,   3.125110803271],
                              [  4.975328278222,  15.948197452169,   4.355611658492],
                              [  4.975328278221,  17.369057452169,   4.355611658492],
                              [  4.975328278221,  20.210777452169,   4.355611658492],
                              [  4.975328278222,  21.300777373974,   4.355611658492],
                              [  4.975328278222,  14.147767530363,   5.586112513713],
                              [  4.975328278222,  15.237767452169,   5.586112513713],
                              [  4.975328278222,  18.079487452169,   5.586112513713],
                              [  4.975328278222,  19.500347452169,   5.586112513713],
                              [  4.975328278222,  15.948197452169,   6.816613368934],
                              [  4.975328278221,  17.369057452169,   6.816613368934],
                              [  4.975328278222,  20.210777452169,   6.816613368934],
                              [  4.975328278221,  21.300777373974,   6.816613368934]]*Angstrom

# Set up configuration
left_electrode = BulkConfiguration(
    bravais_lattice=left_electrode_lattice,
    elements=left_electrode_elements,
    cartesian_coordinates=left_electrode_coordinates
    )

# -------------------------------------------------------------
# Right Electrode
# -------------------------------------------------------------

# Set up lattice
vector_a = [10.0, 0.0, 0.0]*Angstrom
vector_b = [0.0, 27.0, 0.0]*Angstrom
vector_c = [0.0, 0.0, 7.38300513133]*Angstrom
right_electrode_lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
right_electrode_elements = [Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                            Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                            Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen]

# Define coordinates
right_electrode_coordinates = [[  4.975328278222,   5.622607530338,   0.664109092843],
                               [  4.975328278221,   6.712607452145,   0.664109092843],
                               [  4.975328278221,   9.554327452143,   0.664109092843],
                               [  4.975328278222,  10.975187452151,   0.664109092843],
                               [  4.975328278222,   7.423037452149,   1.894609948064],
                               [  4.975328278221,   8.843897452139,   1.894609948064],
                               [  4.975328278222,  11.685617452155,   1.894609948064],
                               [  4.975328278221,  12.775617373945,   1.894609948064],
                               [  4.975328278222,   5.622607530338,   3.125110803285],
                               [  4.975328278222,   6.712607452145,   3.125110803285],
                               [  4.975328278222,   9.554327452143,   3.125110803285],
                               [  4.975328278221,  10.975187452151,   3.125110803285],
                               [  4.975328278221,   7.423037452149,   4.355611658507],
                               [  4.975328278221,   8.843897452139,   4.355611658507],
                               [  4.975328278222,  11.685617452155,   4.355611658507],
                               [  4.975328278222,  12.775617373945,   4.355611658507],
                               [  4.975328278221,   5.622607530338,   5.586112513728],
                               [  4.975328278222,   6.712607452145,   5.586112513728],
                               [  4.975328278222,   9.554327452143,   5.586112513728],
                               [  4.975328278222,  10.975187452151,   5.586112513728],
                               [  4.975328278221,   7.423037452149,   6.816613368949],
                               [  4.975328278222,   8.843897452139,   6.816613368949],
                               [  4.975328278221,  11.685617452155,   6.816613368949],
                               [  4.975328278222,  12.775617373945,   6.816613368949]]*Angstrom

# Set up configuration
right_electrode = BulkConfiguration(
    bravais_lattice=right_electrode_lattice,
    elements=right_electrode_elements,
    cartesian_coordinates=right_electrode_coordinates
    )

# -------------------------------------------------------------
# Central Region
# -------------------------------------------------------------

# Set up lattice
vector_a = [10.0, 0.0, 0.0]*Angstrom
vector_b = [0.0, 27.0, 0.0]*Angstrom
vector_c = [0.0, 0.0, 34.4540239462]*Angstrom
central_region_lattice = UnitCell(vector_a, vector_b, vector_c)

# Define elements
central_region_elements = [Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Hydrogen, Carbon, Carbon,
                           Hydrogen, Carbon, Carbon, Carbon, Hydrogen, Hydrogen, Carbon,
                           Carbon, Carbon, Hydrogen, Carbon, Carbon, Hydrogen, Carbon, Carbon,
                           Carbon, Hydrogen, Hydrogen, Carbon, Carbon, Carbon, Hydrogen,
                           Carbon, Carbon, Hydrogen, Carbon, Carbon, Carbon, Hydrogen,
                           Hydrogen, Carbon, Carbon, Carbon, Hydrogen, Carbon, Carbon,
                           Hydrogen, Carbon, Carbon, Carbon, Hydrogen, Hydrogen, Carbon,
                           Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen, Hydrogen, Carbon,
                           Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen, Hydrogen, Carbon,
                           Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen, Hydrogen, Carbon,
                           Carbon, Carbon, Carbon, Carbon, Carbon, Hydrogen]

# Define coordinates
central_region_coordinates = [[  4.975328278222,  14.147767530363,   0.664109092829],
                              [  4.975328278222,  15.237767452169,   0.664109092829],
                              [  4.975328278222,  18.079487452169,   0.664109092829],
                              [  4.975328278221,  19.500347452169,   0.664109092829],
                              [  4.975328278221,  15.948197452169,   1.89460994805 ],
                              [  4.975328278222,  17.369057452169,   1.89460994805 ],
                              [  4.975328278222,  20.210777452169,   1.89460994805 ],
                              [  4.975328278222,  21.300777373974,   1.89460994805 ],
                              [  4.975328278222,  14.147767530363,   3.125110803271],
                              [  4.975328278222,  15.237767452169,   3.125110803271],
                              [  4.975328278222,  18.079487452169,   3.125110803271],
                              [  4.975328278221,  19.500347452169,   3.125110803271],
                              [  4.975328278222,  15.948197452169,   4.355611658492],
                              [  4.975328278221,  17.369057452169,   4.355611658492],
                              [  4.975328278221,  20.210777452169,   4.355611658492],
                              [  4.975328278222,  21.300777373974,   4.355611658492],
                              [  4.975328278222,  14.147767530363,   5.586112513713],
                              [  4.975328278222,  15.237767452169,   5.586112513713],
                              [  4.975328278222,  18.079487452169,   5.586112513713],
                              [  4.975328278222,  19.500347452169,   5.586112513713],
                              [  4.975328278222,  15.948197452169,   6.816613368934],
                              [  4.975328278221,  17.369057452169,   6.816613368934],
                              [  4.975328278222,  20.210777452169,   6.816613368934],
                              [  4.975328278221,  21.300777373974,   6.816613368934],
                              [  4.975328278221,  14.147767530363,   8.047114224156],
                              [  4.975328278221,  15.237767452169,   8.047114224156],
                              [  4.975328278222,  18.079487452169,   8.047114224156],
                              [  4.975328278222,  19.500347452169,   8.047114224156],
                              [  4.975328278221,  15.948197452169,   9.277615079377],
                              [  4.975328278221,  17.369057452167,   9.277615079377],
                              [  4.975328278222,  20.210777452169,   9.277615079377],
                              [  4.975328278222,  21.300777373974,   9.277615079377],
                              [  4.975328278221,  14.147767530364,  10.508115934607],
                              [  4.975328278222,  15.237767452163,  10.508115934607],
                              [  4.975328278222,  18.079487452173,  10.508115934607],
                              [  4.975328278222,  19.500347452171,  10.508115934607],
                              [  4.975328278222,  20.045347413078,  11.45208355701 ],
                              [  4.975328278221,  15.948197452169,  11.738616789837],
                              [  4.975328278222,  17.369057452167,  11.738616789837],
                              [  4.975328278221,  13.271907491258,  12.02515002264 ],
                              [  4.975328278222,  13.816907452164,  12.969117645043],
                              [  4.975328278221,  15.237767452163,  12.969117645043],
                              [  4.975328278222,  18.079487452173,  12.969117645043],
                              [  4.975328278222,  19.169487373985,  12.969117645043],
                              [  4.975328278221,  12.016477530346,  14.199618500273],
                              [  4.975328278222,  13.106477452158,  14.199618500273],
                              [  4.975328278222,  15.948197452169,  14.199618500273],
                              [  4.975328278222,  17.369057452167,  14.199618500273],
                              [  4.975328278221,  17.914057413073,  15.143586122676],
                              [  4.975328278221,  13.816907452164,  15.430119355479],
                              [  4.975328278222,  15.237767452163,  15.430119355479],
                              [  4.975328278222,  11.140617491254,  15.716652588306],
                              [  4.975328278222,  11.68561745216 ,  16.660620210709],
                              [  4.975328278222,  13.106477452158,  16.660620210709],
                              [  4.975328278222,  15.948197452169,  16.660620210709],
                              [  4.975328278221,  17.038197373981,  16.660620210709],
                              [  4.975328278222,   9.885187530341,  17.891121065939],
                              [  4.975328278222,  10.975187452154,  17.891121065939],
                              [  4.975328278221,  13.816907452164,  17.891121065939],
                              [  4.975328278222,  15.237767452163,  17.891121065939],
                              [  4.975328278221,  15.782767413069,  18.835088688342],
                              [  4.975328278222,  11.68561745216 ,  19.121621921144],
                              [  4.975328278221,  13.106477452158,  19.121621921144],
                              [  4.975328278222,   9.009327491249,  19.408155153971],
                              [  4.975328278221,   9.554327452155,  20.352122776374],
                              [  4.975328278222,  10.975187452154,  20.352122776374],
                              [  4.975328278221,  13.816907452164,  20.352122776374],
                              [  4.975328278222,  14.906907373976,  20.352122776374],
                              [  4.975328278222,   7.753897530337,  21.582623631604],
                              [  4.975328278221,   8.843897452149,  21.582623631604],
                              [  4.975328278222,  11.68561745216 ,  21.582623631604],
                              [  4.975328278221,  13.106477452158,  21.582623631604],
                              [  4.975328278222,  13.651477413064,  22.526591254007],
                              [  4.975328278222,   9.554327452155,  22.81312448681 ],
                              [  4.975328278222,  10.975187452154,  22.81312448681 ],
                              [  4.975328278221,   6.878037491245,  23.099657719637],
                              [  4.975328278221,   7.423037452151,  24.04362534204 ],
                              [  4.975328278222,   8.843897452149,  24.04362534204 ],
                              [  4.975328278221,  11.68561745216 ,  24.04362534204 ],
                              [  4.975328278222,  12.775617373972,  24.04362534204 ],
                              [  4.975328278221,   5.622607530338,  25.27412619727 ],
                              [  4.975328278221,   6.712607452145,  25.27412619727 ],
                              [  4.975328278222,   9.554327452143,  25.27412619727 ],
                              [  4.975328278222,  10.975187452151,  25.27412619727 ],
                              [  4.975328278222,   7.423037452149,  26.504627052492],
                              [  4.975328278222,   8.843897452139,  26.504627052492],
                              [  4.975328278221,  11.685617452155,  26.504627052492],
                              [  4.975328278222,  12.775617373945,  26.504627052492],
                              [  4.975328278222,   5.622607530338,  27.735127907713],
                              [  4.975328278221,   6.712607452145,  27.735127907713],
                              [  4.975328278221,   9.554327452143,  27.735127907713],
                              [  4.975328278222,  10.975187452151,  27.735127907713],
                              [  4.975328278222,   7.423037452149,  28.965628762934],
                              [  4.975328278221,   8.843897452139,  28.965628762934],
                              [  4.975328278222,  11.685617452155,  28.965628762934],
                              [  4.975328278221,  12.775617373945,  28.965628762934],
                              [  4.975328278222,   5.622607530338,  30.196129618155],
                              [  4.975328278222,   6.712607452145,  30.196129618155],
                              [  4.975328278222,   9.554327452143,  30.196129618155],
                              [  4.975328278221,  10.975187452151,  30.196129618155],
                              [  4.975328278221,   7.423037452149,  31.426630473377],
                              [  4.975328278221,   8.843897452139,  31.426630473377],
                              [  4.975328278222,  11.685617452155,  31.426630473377],
                              [  4.975328278222,  12.775617373945,  31.426630473377],
                              [  4.975328278221,   5.622607530338,  32.657131328598],
                              [  4.975328278222,   6.712607452145,  32.657131328598],
                              [  4.975328278222,   9.554327452143,  32.657131328598],
                              [  4.975328278222,  10.975187452151,  32.657131328598],
                              [  4.975328278221,   7.423037452149,  33.887632183819],
                              [  4.975328278222,   8.843897452139,  33.887632183819],
                              [  4.975328278221,  11.685617452155,  33.887632183819],
                              [  4.975328278222,  12.775617373945,  33.887632183819]]*Angstrom

# Set up configuration
central_region = BulkConfiguration(
    bravais_lattice=central_region_lattice,
    elements=central_region_elements,
    cartesian_coordinates=central_region_coordinates
    )

# Add metallic region
metallic_region_0 = BoxRegion(
    1.3*Volt,
    xmin = 0.0*Angstrom, xmax = 0.5*Angstrom,
    ymin = 0.0*Angstrom, ymax = 27.0*Angstrom,
    zmin = 9.23023301519*Angstrom, zmax = 25.2306817358*Angstrom,
)

metallic_regions = [metallic_region_0]
central_region.setMetallicRegions(metallic_regions)

# Add dielectric region
dielectric_region_0 = BoxRegion(
    4.0,
    xmin = 0.5*Angstrom, xmax = 3.58*Angstrom,
    ymin = 0.0*Angstrom, ymax = 27.0*Angstrom,
    zmin = 9.23023301519*Angstrom, zmax = 25.2306817358*Angstrom,
)

dielectric_regions = [dielectric_region_0]
central_region.setDielectricRegions(dielectric_regions)

device_configuration = DeviceConfiguration(
    central_region,
    [left_electrode, right_electrode],
    equivalent_electrode_lengths=[7.38300513133, 7.38300513133]*Angstrom,
    transverse_electrode_repetitions=[[1, 1], [1, 1]],
    )

# -------------------------------------------------------------
# Calculator
# -------------------------------------------------------------
#----------------------------------------
# Hamiltonian Parametrization
#----------------------------------------
basis_set = [
    CerdaHuckelParameters.Carbon_graphite_Basis,
    HoffmannHuckelParameters.Hydrogen_Basis,
    ]

hamiltonian_parametrization = HuckelHamiltonianParametrization(
    basis_set=basis_set)

#----------------------------------------
# Numerical Accuracy Settings
#----------------------------------------
device_k_point_sampling = MonkhorstPackGrid(
    nc=50,
    )
device_numerical_accuracy_parameters = NumericalAccuracyParameters(
    k_point_sampling=device_k_point_sampling,
    density_mesh_cutoff=75.0*Hartree,
    )

#----------------------------------------
# Iteration Control Settings
#----------------------------------------
device_iteration_control_parameters = IterationControlParameters()

#----------------------------------------
# Poisson Solver Settings
#----------------------------------------
device_poisson_solver = MultigridSolver(
    boundary_conditions=[[NeumannBoundaryCondition(),NeumannBoundaryCondition()],
                         [NeumannBoundaryCondition(),NeumannBoundaryCondition()],
                         [DirichletBoundaryCondition(),DirichletBoundaryCondition()]]
    )

#----------------------------------------
# Device Calculator
#----------------------------------------
calculator = DeviceSemiEmpiricalCalculator(
    hamiltonian_parametrization=hamiltonian_parametrization,
    numerical_accuracy_parameters=device_numerical_accuracy_parameters,
    iteration_control_parameters=device_iteration_control_parameters,
    poisson_solver=device_poisson_solver,
    )

device_configuration.setCalculator(calculator)
nlprint(device_configuration)
device_configuration.update()
nlsave('zaz66_gate_pos1_3_big_har.hdf5', device_configuration)



# -------------------------------------------------------------
# Transmission Spectrum
# -------------------------------------------------------------
kpoint_grid = MonkhorstPackGrid()

transmission_spectrum = TransmissionSpectrum(
    configuration=device_configuration,
    energies=numpy.linspace(-2, 2, 200)*eV,
    kpoints=kpoint_grid,
    energy_zero_parameter=AverageFermiLevel,
    infinitesimal=1e-06*eV,
    self_energy_calculator=RecursionSelfEnergy(),
    enforce_zero_in_band_gap=True,
    )
nlsave('zaz66_gate_pos1_3_big_har.hdf5', transmission_spectrum)
nlprint(transmission_spectrum)
